{% extends "base_generic.html" %}

{% block links %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/styles.css' %}">
{% endblock %}

{% block body %}
<div class="form">

    <ul class="tab-group">
        <li class="tab active"><a href="#profile">Profile</a></li>
        <li class="tab"><a href="#recognize">Recognize</a></li>
    </ul>

    <div class="tab-content">
        <div id="profile">
            <h1>Hello, {{ user.username }}!</h1>

            <ul class="tab-group">
            <li class="profile_info">
            <form action="{% url 'change_pass' %}" method="post">
                {% csrf_token %}

                <h1>Change password</h1>
                <div class="field-wrap">
                    <label>
                        Old password<span class="req">*</span>
                    </label>
                    {{ change_form.old_password }}
                </div>

                <div class="field-wrap">
                    <label>
                        New password<span class="req">*</span>
                    </label>
                    {{ change_form.new_password }}
                </div>

                <div class="field-wrap">
                    {% if messages %}
                        {% for message in messages %}
                            <label class="err_msg" id="change_err">{{ message }}</label>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="field-wrap">
                    <button type="submit" class="button button-block" id="change_button">Change password</button>
                </div>

            </form>
            </li>

            <li class="profile_info"><form>

                <div class="field-wrap">
                    <label class="info">
                      You recognized {{ user.profile.uploads_count }} face expressions already!
                    </label>
                </div>

                <div class="field-wrap">
                    <label class="info">
                        Last processed image:
                    </label>
                </div>

                <div class="field-wrap"></div>

                <div class="field-wrap">
                    <div class="img-div" id="show-field">
                        {% if last_img %}
                            <input type="image" class="load_image" accept="image/*" disabled src="{{ last_img.url }}">
                        {% else %}
                            <label><span class="req">Last processed image will be shown here</span></label>
                        {% endif %}
                    </div>
                </div>

            </form></li>
            </ul>

            <form action="{% url 'logout' %}" method="post">
              {% csrf_token %}
              <div class="field-wrap">
                  <button type="submit" class="button button-block" id="out_button">Log out</button>
              </div>
            </form>

        </div>

        <div id="recognize">
            <h1>Recognize face expression</h1>

            <ul class="tab-group">
            <li class="photo_upload">
            <form method="post" enctype="multipart/form-data" action="{% url 'upload' %}" id="img_upload">
                {% csrf_token %}

                <div class="field-wrap">
                    <label>
                        Title<span class="req">*</span>
                    </label>
                    {{ img_form.title }}
                </div>

                <div class="field-wrap2">
                    <div class="img-div" id="upload-field">
                        {{ img_form.image }}
                        <label for="id_image" class="file-choose">
                            <span class="req">Click to upload a file.</span><span id="loaded-file"> File not selected</span>
                        </label>
                    </div>
                </div>

                <div class="field-wrap">
                    <label class="err_msg" id="upload_err">{{ upload_err }}</label>
                </div>

                <div class="field-wrap">
                    <button type="submit" class="button button-block" id="rec_button">Recognize</button>
                </div>

            </form>
            </li>
            <li class="photo_upload">
            <form>

                <div class="field-wrap">
                    <div class="img-div">
                        {% if rec_img %}
                            <input type="image" class="load_image" accept="image/*" disabled src="{{ rec_img.url }}">
                        {% else %}
                            <label><span class="req">Processed image will be shown here</span></label>
                        {% endif %}
                    </div>
                </div>

                <div class="field-wrap">
                    {% if rec_img %}
                        <a download href="{{ rec_img.url }}" id="load_ref">Download</a>
                    {% endif %}
                </div>

            </form>
            </li>
            </ul>

        </div>

    </div>

</div>

    <script type="text/javascript" src="{% static 'main/js/index.js' %}"></script>
    {% if swap %}
        <script>
            $('.tab a').trigger("click", [false]);
        </script>
    {% endif %}

{% endblock %}
